\documentclass[10pt,twocolumn]{article}

%% \usepackage{times}
%% %\usepackage{fullpage}
%% \usepackage[tmargin=1in,bmargin=1in,lmargin=0.75in,rmargin=0.75in,columnsep=0.25in]{geometry}    % Exert more control over the margins
%% \usepackage{mathptm}     % Puts math text into the postscript Times font and symbol font (else uses the metafont-generated characters)
%% \usepackage{amsmath}     % Provides various features to facilitate writing math formulas and to improve the typographical quality of their output
%% \usepackage{amsfonts}
%% \usepackage{float}       % Basic package for floating objects like figures and tables
%% \usepackage{psfrag}      % Used to insert text into figures
%% \usepackage{floatflt}    % Used to wrap text around figures
%% \usepackage{graphicx}    % Used to display graphic figures and such
\usepackage{xspace}      % Intelligently adds space after a word via \xspace
%% \usepackage{color}       % Used to highlight comments
%% \usepackage{pifont}      % Provides the ding symbol used for comments
\usepackage{subcaption}  % Place two related figures side-by-side
%% \usepackage{url}         % Properly formats URLs
%% \usepackage{array}       % Add more space to the tables
%% \usepackage{algorithm}   % Defines algorithm float environment
%% \usepackage{algorithmic} % Defines algorithm macros (add [noend] to get rid of "end while" statements)
%% \usepackage{multirow}    % Use to create table with a column that spans multiple rows
%% \usepackage{enumerate}   % Control the numbering for enumerated lists
%% \usepackage{listings}    % In-line code listings
%% %\usepackage{fancyhdr}    % Control over headers and footers
%% %\usepackage{lastpage}    % Allows you to learn the total number of pages (via \pageref{LastPage})
%% %\usepackage{layouts}     % Use to display layout length info, e.g., \printinunitsof{cm}\prntlen{\textwidth}
%% \usepackage[small,compact]{titlesec}  % Reduce space around section headings
%% \usepackage[square,comma,numbers,sort&compress]{natbib}      % Offers more control over citation appearance and bib spacing
%% \usepackage{dafny}
%% \usepackage{graphicx}
%% %\usepackage{cite}        % Orders and condenses citations (conflicts with natbib package)
%% %\usepackage{multicol}	% jonh tried to use this to make a 2-col verbatim figure, but it broke the first page!
%% %\usepackage{siunitx}     % Allow columns to be aligned on decimal points

%% \usepackage{microtype}
%% \usepackage{booktabs}
%% \usepackage{fancyvrb}
%% \usepackage{minted}
\usepackage{tikz}
\usepackage{pgfplots}
%\pgfplotsset{compat=1.3}
%\usetikzlibrary{external}
\usetikzlibrary{patterns}
%\tikzexternalize[prefix=pgfplots/]
%\pgfplotsset{invoke before crossref tikzpicture={\tikzexternaldisable},invoke after crossref tikzpicture={\tikzexternalenable}}

%% \usemintedstyle{friendly}

%% %%%%%%%%% Float stuff  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \renewcommand{\textfraction}{0}
%% \renewcommand{\topfraction}{1}
%% \renewcommand{\bottomfraction}{1}
%% \setcounter{totalnumber}{10}
%% \setcounter{topnumber}{10}
%% \setcounter{bottomnumber}{10}
%% \setcounter{dbltopnumber}{10}
%% \renewcommand{\floatpagefraction}{1}
%% \renewcommand{\dblfloatpagefraction}{0.8}

%% %%%%%%%%% Squeeze tricks  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% %\addtolength{\hoffset}{-2mm}
%% %\addtolength{\textwidth}{4mm}
%% %\addtolength{\voffset}{-1.5\baselineskip}
%% %\addtolength{\textheight}{2\baselineskip}
%% %\addtolength{\textheight}{0.6in}

%% %%%%% Squeeze space on enumerations
%% \makeatletter
%% \def\@listi{\leftmargin\leftmargini
%%     \parsep 1\p@ \@plus0\p@ \@minus\p@
%%     \topsep 2\p@   \@plus0\p@ \@minus\p@
%% %    \topsep 2\p@   \@plus2\p@ \@minus2\p@
%% %    \itemsep1.25\p@ \@plus\p@ \@minus\p@}
%%     \itemsep1\p@ \@plus0\p@ \@minus\p@}
%% \let\@listI\@listi\@listi
%% \makeatother

%% % Reduce spacing between bib entries.
%% %\setlength{\bibsep}{0.0pt}

%% % Squeeze space on paragraphs
%% \renewcommand{\paragraph}[1]{\noindent\textbf{#1.}}

%% %%%%%%%%% Create hyperlinks and bookmarks %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% % PDF
%% \usepackage{hyperref}
%% \hypersetup{
%% %\ifpdf
%% %        pdftex,
%% %\else
%% %        dvipdf,
%% %\fi
%%   %pdftex,              % using ps2pdf vs pdftex
%%   %ps2pdf,              % using ps2pdf vs pdftex
%% 	%hypertex,
%%   colorlinks=true,     % color the words instead of use a colored box
%%   urlcolor=blue,       % \href{...}{...} external (URL)
%% %  filecolor=blue,      % \href{...} local file
%%   linkcolor=blue,     % \ref{...} and \pageref{...}
%%   citecolor=blue,     % \cite{}
%% % letterpaper=true,
%%   plainpages=false,
%% %    plainpages          boolean         true
%% %    Forces page anchors to be named by the arabic form of the page number,
%% %    rather than the formatted form.
%%   breaklinks=true,
%% %    breaklinks          boolean         false
%% %    Allows link text to break across lines; since this cannot be accommodated in
%% %    PDF, it is only set true by default if the pdftex driver is used. This makes
%% %    links on multiple lines into different PDF links to the same target.
%% % pagebackref=true,
%% %     Adds ?backlink? text to the end of each item in the bibliography, as a list
%% %     of section numbers. This can only work properly if there is a blank line
%% %     after each \bibitem.
%%   bookmarksnumbered=true,
%% %    bookmarksnumbered   boolean         false
%% %    If Acrobat bookmarks are requested, include section numbers.
%%   bookmarksopen=true,
%% %    bookmarksopen       boolean         false
%% %    If Acrobat bookmarks are requested, show them with all the subtrees expanded.
%%   pdftitle={},
%%   pdfauthor={},
%%   pdfkeywords={},
%% % pdfpagelabels=true,
%%   pdfpagemode=UseOutlines  % None, UseThumbs, UseOutlines, FullScreen
%%   }
%% \usepackage{cleveref}

%%%%%%%%%  Macros  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Paper Specific Macros
%\newcommand{\name}{VeriBetrKV\xspace}
\newcommand{\name}{VeriSafeKV\xspace} % blinded for submission
% \newcommand{\namelinear}{VeriSafeKV-Linear\xspace} % blinded for submission
\newcommand{\method}{VeriMethod\xspace}
% NB: don't put space in the macro, because sometimes we want to make
% compound words with these symbols.
% Use the macro in braces {\btree} so the space in the text serves as
% a space (rather than a macro delimiter).
\newcommand{\btree}{B-tree\xspace}
\newcommand{\btrees}{B-trees\xspace}
\newcommand{\Btree}{B-Tree\xspace}
\newcommand{\Btrees}{B-Trees\xspace}
\newcommand{\beptree}{B\ensuremath{^\epsilon}-tree\xspace}
\newcommand{\beptrees}{B\ensuremath{^\epsilon}-trees\xspace}
\newcommand{\Beptree}{B\ensuremath{^\epsilon}-Tree\xspace}
\newcommand{\Beptrees}{B\ensuremath{^\epsilon}-Trees\xspace}
\newcommand{\circnum}[1]{\raisebox{.5pt}{\textcircled{\raisebox{-.9pt} {#1}}}}
\newcommand{\iosystem}{IOSystem\xspace}
\newcommand{\template}[1]{$\langle$#1$\rangle$}

%%%%%%%%%  Paper Info %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{\vspace{-2mm}
Storage Systems are Distributed Systems\\
(So Verify Them That Way!)
\\\vspace{2mm}{\large\textbf{OSDI 2020 Artifact Reprodcubility Experiment Results}}
}

\date{}

%%%%%%%%%  Main Body %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\maketitle
%\thispagestyle{empty}

%% \input{data/automation-constants}
%% \input{data/verification-constants}
%% \input{data/performance-numbers}
\input{build/linear-line-counts}

\begin{figure}
\begin{center}
\input{build/Impl/Bundle.i.lcreport}
\end{center}
  \vspace{-3mm}
\caption{Line counts by major components.}
\label{line-counts}
\end{figure}

\begin{figure}
  \begin{center}
    \input{build/linear-line-count-table}
    %% \begin{tabular}{|l|rr|rr|}
    %%   \hline
    %%   & \multicolumn{2}{c|}{hash table} & \multicolumn{2}{c|}{search tree} \\
    %%   Aliasing reasoning & impl & proof & impl & proof \\
    %%   \hline
    %%   Dynamic frames & \HashtableReprImpl & \HashtableReprProof & \BTreeReprImpl & \BTreeReprProof \\
    %%   %Linear type system & 289 & 1063 & 373 & 1531  \\
    %%   \hline
    %% \end{tabular}

  \end{center}
  \vspace{-3mm}
  \caption{Line counts of two subcomponents.
    %, comparing dynamic-frame implementations with  our linear type system.\protect\footnotemark~
    %Linear typing reduces the proof burden by 31-37\%
  }
  \label{line-counts-micro}
  \vspace{-2mm}
\end{figure}

\begin{figure}
\includegraphics[width=1\columnwidth]{build/verification-times.pdf}
  \vspace{-5mm}
\caption{Cumulative distribution of verification times of function
  definitions, implementation methods, and proof lemmas.
  %Most
  %definitions--{\twentySecFasterPctile}--verify in less than {\twentySecSlowThresholdSecs}s,
  %and {\tenSecFasterPctile}--verify in less than {\tenSecSlowThresholdSecs}s.
  }
  \vspace{-4mm}
\label{verification-times}
\end{figure}

\begin{figure*}
\includegraphics[width=1\textwidth,ext=.i.status.pdf,type=pdf,read=*]{build/Impl/Bundle}
\caption{Verification results.}
\label{verification-results}
\end{figure*}

\begin{figure}
\includegraphics[width=1\columnwidth]{build/automation-figure.pdf}
  \vspace{-4mm}
  \caption{Distribution of definition revelations.}
  \vspace{-3mm}
\label{automation-histogram}
\end{figure}

\newcommand{\ycsbHddDataDir}{data/ycsb-hdd/golden}
\newcommand{\ycsbSsdDataDir}{data/ycsb-ssd/golden}
\newcommand{\mutablebtreeDataDir}{data/mutablebtree/silver}

\pgfplotsset{
  GenericBarplot/.style={
    ybar=1pt,
    bar width=5.5pt,
    height = 1.75in,
    enlarge x limits=0.1,
    major x tick style = transparent,
    scaled y ticks=false,
    ylabel near ticks,
    point meta=rawy,
    nodes near coords,
    every node near coord/.append style={rotate=90, anchor=west, font=\tiny},
    nodes near coords={\pgfmathprintnumber[fixed, precision=0]{\pgfplotspointmeta}},
    area legend,
    legend columns=-1,
    label style={font=\small, align=center},
  },
  MinMidMaxFile/.style n args={3}{
    /pgfplots/error bars/y dir=both,
    /pgfplots/error bars/y explicit,
    table/y error plus expr = (\thisrow{#3} - \thisrow{#2}),
    table/y error minus expr = (\thisrow{#2} - \thisrow{#1}),
  }
}

\pgfplotsset{
  YcsbThroughput/.style={
    GenericBarplot,
    symbolic x coords = {Load, A, B, C, D, F, Cuniform},
    ylabel={Operations/Second},
    MinMidMaxFile={MinThroughput}{MedianThroughput}{MaxThroughput},
  },
  YcsbLoadThroughput/.style={
    YcsbThroughput,
    width = 1.1in,
    restrict x to domain=0:0,
    xtick = {Load},
    xlabel={(from YCSB A)},
  },
  YcsbRunThroughput/.style={
    YcsbThroughput,
    width = 3.1in,
    xmin = A,
    xmax = Cuniform,
    restrict x to domain=1:10,
    xtick = {A, B, C, D, F, Cuniform},
    xticklabels = {A, B, C, D, F, U},
    xlabel={YCSB Workload},
  },
}

\pgfplotsset{
    LinearStyle/.style={teal, fill=teal!10!white, postaction={pattern=north west lines, pattern color=teal!50!white}},
    HeapStyle/.style={violet!50!black, fill=violet!50!black!10!white, postaction={pattern=north east lines, pattern color=violet!50!black!50!white}},
}

\pgfplotsset{
    BerkeleyStyle/.style={blue, fill=blue!10!white, postaction={pattern=crosshatch dots, pattern color=blue!50!white}},
    VeriHeapStyle/.style={HeapStyle},
    VeriLinearStyle/.style={LinearStyle},
    RocksStyle/.style={red, fill=red!05!white, postaction={pattern=crosshatch, pattern color=red!50!white}},
}

\begin{figure*}
\centering
\ref{ycsb-legend}
  \begin{tikzpicture}
    \begin{axis}[
        YcsbLoadThroughput,
        ymode = log,
        %ymax = 100000,
        %ytick = { 100, 1000, 10000, 100000, 1000000 },
        legend columns=1,
        legend to name={ycsb-legend},
      ]
      \addplot+ [BerkeleyStyle] table {build/BerkeleyYcsb.csv};
      \addlegendentry{BerkeleyDB}
      \addplot+ [VeriLinearStyle] table {build/VeribetrfsYcsb.csv};
      \addlegendentry{\name}
      \addplot+ [RocksStyle] table {build/RocksYcsb.csv};
      \addlegendentry{RocksDB}
    \end{axis}
  \end{tikzpicture}
  \begin{tikzpicture}
    \begin{axis}[
        YcsbRunThroughput,
        %ymin = 0,
        %ymax = 800,
      ]
      \addplot+ [BerkeleyStyle] table {build/BerkeleyYcsb.csv};
      \addplot+ [VeriLinearStyle] table {build/VeribetrfsYcsb.csv};
      \addplot+ [RocksStyle] table {build/RocksYcsb.csv};
    \end{axis}
  \end{tikzpicture}

%% \begin{subfigure}{\textwidth}
%%   \centering
%%   \parbox[c]{0.1\textwidth}{\subcaption{SSD}} ~
%%   \parbox[c]{0.7\textwidth}{
%%   \begin{tikzpicture}
%%     \begin{axis}[
%%         YcsbLoadThroughput,
%%         ymode = log,
%%         ymax = 200000,
%%         ytick = { 100, 1000, 10000, 100000, 1000000 },
%%       ]
%%       \addplot+ [BerkeleyStyle] table {\ycsbSsdDataDir/berkeleydb.csv};
%%       % \addlegendentry{BerkeleyDB}
%%       \addplot+ [VeriHeapStyle] table {\ycsbSsdDataDir/veribetrkv-128k.csv};
%%       % \addlegendentry{\name-Dynamic Frames}
%%       \addplot+ [VeriLinearStyle] table {\ycsbSsdDataDir/veribetrkv-linear-128k.csv};
%%       % \addlegendentry{\name}
%%       \addplot+ [RocksStyle] table {\ycsbSsdDataDir/rocksdb.csv};
%%       % \addlegendentry{RocksDB}
%%     \end{axis}
%%   \end{tikzpicture}
%%   \begin{tikzpicture}
%%     \begin{axis}[
%%         YcsbRunThroughput,
%%         ymin = 0,
%%         ymax = 20000,
%%         ytick = { 5000, 10000, 15000, 20000, 1000000 },
%%       ]
%%       \addplot+ [BerkeleyStyle] table {\ycsbSsdDataDir/berkeleydb.csv};
%%       \addplot+ [VeriHeapStyle] table {\ycsbSsdDataDir/veribetrkv-128k.csv};
%%       \addplot+ [VeriLinearStyle] table {\ycsbSsdDataDir/veribetrkv-linear-128k.csv};
%%       \addplot+ [RocksStyle] table {\ycsbSsdDataDir/rocksdb.csv};
%%     \end{axis}
%%   \end{tikzpicture}
%%   }
%%   \hspace{0.9in}
%%   \label{subfig:ycsb-ssd}
%% \end{subfigure}
% %   \caption{
% %     Median throughput of YCSB workloads with 24B keys and 512B
% %     values running on a HDD and 2GB of RAM.  Load is 10M operations
% %     ($\approx$ 5GB of data) and runs are 10000 operations each.
% %     Workload ``U'' is a workload of uniformly random queries.
% %     Error
% %     bars indicate min/max of 6 runs.  Higher is
% %     better.}\label{fig:ycsb-hdd-512B}
\caption{
Median throughput of YCSB workloads values.  Load is 10M operations
($\approx$ 5GB of data) and runs are 10000 operations each.
Higher is better.
}
\label{fig:ycsb}
\end{figure*}

\begin{figure}
\centering
%\ref{micro-legend}
\begin{subfigure}[t]{.25\textwidth}
  \begin{tikzpicture}
    \begin{axis}[
        GenericBarplot,
        enlarge x limits=0.2,
        width = 1.8in,
        symbolic x coords = {insert, readpositive, readnegative, remove},
        xtick = {insert, readpositive, readnegative, remove},
        xticklabels = {Insert, Pos. Query, Neg. Query, Delete},
        x tick label style={rotate=90},
        ymin = 0,
        %ymax = 8300000,
        %ytick = {0, 2000000, 4000000, 6000000, 8000000},
        %yticklabels={0, 2M, 4M, 6M, 8M},
        ylabel={Operations/Second},
        legend to name={micro-legend},
        MinMidMaxFile={min}{med}{max},
      ]
      \addplot+ [HeapStyle] table {build/mutable-map-benchmark.csv};
      %\addlegendentry{Dynamic Frames}
      %\addplot+ [LinearStyle] table {\mutablemapDataDir/linear.csv};
      %\addlegendentry{Linear}
    \end{axis}
  \end{tikzpicture}
  \subcaption{Hash table}
  \label{subfig:micro-hashtable}
\end{subfigure}~%
\hspace{0.3in}
\begin{subfigure}[t]{.2\textwidth}
  \centering
  \parbox{1.7\textwidth}{
    \vspace{-2.475in}
  \begin{tikzpicture}
    \begin{axis}[
        GenericBarplot,
        enlarge x limits=0.5,
        width = 1.3in,
        symbolic x coords = {write,read},
        xtick = {write, read},
        xticklabels = {Insert, Query},
        x tick label style={rotate=90},
        ymin = 0,
        %ymax = 300000,
        %ylabel={Operations/Second},
        MinMidMaxFile={min}{med}{max},
      ]
      \addplot+ [HeapStyle] table {build/mutable-btree-benchmark.csv};
      %\addplot+ [LinearStyle] table {\mutablebtreeDataDir/8000000-linear.csv};
    \end{axis}
  \end{tikzpicture}}\\
  \subcaption{Search tree}
  \label{subfig:micro-btree}
\end{subfigure}
\caption{Throughput of subcomponent microbenchmarks.
  Higher is better. 
}\label{fig:datastructures-micro}
\end{figure}


\end{document}
